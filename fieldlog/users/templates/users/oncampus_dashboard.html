{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
  /* ==== Dashboard Custom Styles === */

  .dashboard-container {
    background-color: #00000ad3; /* Dark solid background */
    color: #e0e0f0;
    padding: 2rem;
    border-radius: 12px;
  }

  h2, h3 {
    color: #a8b0ff;
    font-weight: 600;
  }

  .card {
    background-color: #2a5c3eee;
    border: none;
    border-radius: 12px;
    color: #ebebf3ff;
    font-size: larger;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
    
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.6);
  }

  .table {
    background-color: #2a5c3eee;
    color: whitesmoke;
  }

  .table th, .table td {
    vertical-align: middle !important;
    text-align: center;
    border-color: #02030cff;
    border-style: solid;
  }

  .table thead th {
    background-color: #040518ff;
    color: #c0c8ff;
    font-size: 0.95rem;
  }

  .table tbody tr:hover {
    background-color: #156b36ff;
    color: white;
  }

  /* Buttons */
  .btn-outline-primary {
    color: #a8b0ff;
    border-color: #a8b0ff;
  }

  .btn-outline-primary:hover {
    background-color: #a8b0ff;
    color: #2c2a6c;
  }

  .btn-outline-success {
    color: #92d36e;
    border-color: #92d36e;
  }

  .btn-outline-success:hover {
    background-color: #92d36e;
    color: #1f2c16;
  }

  .btn-outline-danger {
    color: #f67280;
    border-color: #f67280;
  }

  .btn-outline-danger:hover {
    background-color: #f67280;
    color: #3a0b0e;
  }

  .btn:hover {
    opacity: 0.9;
  }

  /* Ripple Effect */
  .btn {
    position: relative;
    overflow: hidden;
  }

  .btn::after {
    content: "";
    position: absolute;
    border-radius: 50%;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
    transform: scale(0);
    background: rgba(255,255,255,0.4);
    transition: transform 0.3s ease-out;
  }

  .btn:active::after {
    transform: scale(2.5);
    transition: 0s;
  }

  .table-responsive {
    overflow-x: auto;
  }

  .me-2 {
    margin-right: 0.5rem !important;
  }
</style>

<div class="container dashboard-container mt-5">

  <header class="mb-4 text-center">
      <h2>On-Campus Supervisor Dashboard & Field Logbook Report</h2>
  </header>

  <!-- Cards -->
  <section class="row text-center mb-5 g-3">
      <div class="col-md-3">
          <div class="card p-3">
              <h6 class="text-uppercase fw-semibold">Total Department Students</h6>
              <p class="display-5 mb-0">{{ department_students_count }}</p>
          </div>
      </div>
      <div class="col-md-3">
          <div class="card p-3">
              <h6 class="text-uppercase fw-semibold">Total On-Station Supervisors</h6>
              <p class="display-5 mb-0">{{ total_supervisors }}</p>
          </div>
      </div>
      <div class="col-md-3">
          <div class="card p-3">
              <h6 class="text-uppercase fw-semibold">Submitted Logs</h6>
              <p class="display-5 mb-0">{{ submitted_logs }}</p>
          </div>
      </div>
      <div class="col-md-3">
          <div class="card p-3">
              <h6 class="text-uppercase fw-semibold">Pending Approvals</h6>
              <p class="display-5 mb-0">{{ pending_logs }}</p>
          </div>
      </div>
  </section>

  <!-- Table -->
  <section class="mb-5">
      <h3 class="mb-3">Students Supervised by On-Station Supervisors</h3>
      <div class="table-responsive shadow-sm rounded">
          <table class="table table-bordered table-hover align-middle">
              <thead>
                  <tr>
                      <th>Name</th>
                      <th>Reg Number</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Supervisor</th>
                      <th>Actions</th>
                  </tr>
              </thead>
              <tbody>
                  {% for student in department_students %}
                  <tr>
                      <td>{{ student.user.get_full_name }}</td>
                      <td>{{ student.registration_number }}</td>
                      <td>{{ student.user.email }}</td>
                      <td>{{ student.phone }}</td>
                      <td>
                          {% if student.supervisor_onstation %}
                              {{ student.supervisor_onstation.get_full_name }}
                          {% else %}
                              <span class="text-muted">Unassigned</span>
                          {% endif %}
                      </td>
                      <td>
                          <a href="{% url 'logbook:view_logs' student.id %}" class="btn btn-sm btn-outline-primary">View Logs</a>
                          <a href="{% url 'users:download_logs_pdf' student.id %}" class="btn btn-sm btn-outline-danger">Download PDF</a>
                      </td>
                  </tr>
                  {% empty %}
                  <tr><td colspan="6" class="text-center">No students found.</td></tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
  </section>

  <!-- Department Tasks -->
  <section class="mb-5">
      <h3>Department Tasks & Resources</h3>
      <div class="mb-3">
          <a href="{% url 'users:upload_department_resource' %}" class="btn btn-outline-primary me-2">Upload Resources</a>
          <a href="{% url 'users:assign_task_to_students' %}" class="btn btn-outline-success me-2">Assign Tasks</a>
          <a href="{% url 'users:track_progress' %}" class="btn btn-outline-info">Track Progress</a>
      </div>
  </section>
</div>

{% endblock %}
