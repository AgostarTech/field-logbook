{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<style>
  /* Table container */
  .files-table-container {
    max-width: 1100px;
    margin: 30px auto 60px auto;
    padding: 15px;
    background-color: #f8fcf9ff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    font-family: Arial, sans-serif;
  }

  /* Table styles */
  table.files-table {
    width: 100%;
    border-collapse: collapse;
    color: #1e293b;
  }

  table.files-table th,
  table.files-table td {
    padding: 12px 15px;
    border: 1px solid #e2e8f0;
    vertical-align: middle;
    text-align: left;
  }

  table.files-table th {
    background-color: #076335ff;
    color: white;
    font-weight: 600;
  }

  table.files-table tr:nth-child(even) {
    background-color: #f1f5f9;
  }

  table.files-table tr:hover {
    background-color: #dbeafe;
  }

  /* Image/Icon preview */
  .file-preview-cell {
    width: 80px;
    text-align: center;
  }

  .file-preview-cell img,
  .file-preview-cell svg {
    max-height: 60px;
    max-width: 60px;
    border-radius: 6px;
    object-fit: contain;
  }

  /* Action buttons */
  .action-icons {
    display: flex;
    gap: 8px;
  }

  .action-icon {
    cursor: pointer;
    display: inline-block;
  }

  .action-icon svg {
    vertical-align: middle;
    transition: opacity 0.3s ease;
  }

  .action-icon:hover svg {
    opacity: 0.7;
  }

  /* Responsive */
  @media (max-width: 768px) {
    table.files-table th, table.files-table td {
      padding: 8px 10px;
      font-size: 13px;
    }

    .file-preview-cell {
      width: 60px;
    }

    .file-preview-cell img,
    .file-preview-cell svg {
      max-height: 45px;
      max-width: 45px;
    }
  }
</style>
{% endblock %}

{% block content %}
  <h2 style="text-align:center; color:#0ea5e9; margin-top: 30px;">Uploaded Files</h2>

  <div class="files-table-container">
    {% if files %}
      <table class="files-table" aria-label="Uploaded files details">
        <thead>
          <tr>
            <th>Preview</th>
            <th>ID</th>
            <th>File Name</th>
            <th>Upload Date</th>
            <th>Description</th>
            <th>Uploaded By</th>
            <th>Type</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for file in files %}
            <tr>
              <td class="file-preview-cell">
                {% if file.is_image %}
                  <img src="{{ file.file.url }}" alt="Image preview" />
                {% else %}
                  <!-- Document SVG icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" viewBox="0 0 384 512" fill="#555">
                    <path d="M224 136v-136H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.3 0-24-10.7-24-24zM384 121.9V128h-82.1c-7.5 0-14.6-3.7-18.8-9.7L256 91.6 309.4 38.2c6-6 14.1-9.7 22.6-9.7H384v93.4z"/>
                  </svg>
                {% endif %}
              </td>
              <td>{{ file.id }}</td>
              <td title="{{ file.file.name }}">{{ file.file.name|slice:"8:" }}</td>
              <td>{{ file.uploaded_at|date:"Y-m-d H:i" }}</td>
              <td>{{ file.description|default:"-" }}</td>
              <td>{{ file.uploader_name }}</td>
              <td>{{ file.file_type }}</td>
              <td>
                <div class="action-icons">
                  <a href="{{ file.file.url }}" download title="Download file" class="action-icon">
                    <!-- Download SVG icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 512 512" fill="#0ea5e9">
                      <path d="M480 352v64a48 48 0 01-48 48H80a48 48 0 01-48-48v-64"/>
                      <polyline points="176 240 256 320 336 240" fill="none" stroke="#0ea5e9" stroke-width="32" stroke-linejoin="round" stroke-linecap="round"/>
                      <line x1="256" y1="320" x2="256" y2="64" fill="none" stroke="#0ea5e9" stroke-width="32" stroke-linejoin="round" stroke-linecap="round"/>
                    </svg>
                  </a>

                  <form action="{% url 'logbook:delete_file' file.id %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" title="Delete file" class="action-icon delete-btn" onclick="return confirm('Are you sure you want to delete this file?');" style="background:none; border:none; padding:0;">
                      <!-- Delete SVG icon -->
                      <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 448 512" fill="#dc3545">
                        <path d="M135.2 17.7C140.7 7.1 151.9 0 164 0h120c12.1 0 23.3 7.1 28.8 17.7L328 32h80c8.8 0 16 7.2 16 16s-7.2 16-16 16H40c-8.8 0-16-7.2-16-16s7.2-16 16-16h80l15.2-14.3zM53.2 467c0 26.5 21.5 48 48 48h245.6c26.5 0 48-21.5 48-48V128H53.2v339z"/>
                      </svg>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p style="text-align:center; color:#64748b; padding: 20px 0;">No files uploaded yet.</p>
    {% endif %}
  </div>
{% endblock %}
